var kilo,use,register,CommonJS=!1;"object"==typeof exports&&"function"==typeof require&&(kilo=require("kilo"),kilo&&(use=kilo.use,register=kilo.register,CommonJS=!0)),register("Canvas",[],function(){"use strict";return{clearContext:function(t,e,r){t.clearRect(0,0,e,r)},drawBackground:function(t,e,r,n,o,i){t.fillStyle=i||"red",t.fillRect(n||0,o||0,e,r)},drawBorder:function(t,e,r,n,o,i){t.beginPath(),t.strokeStyle=i||"black",t.rect(n||0,o||0,e,r),t.stroke(),t.closePath()}}}),register("Factory",["Obj","Pool"],function(t){"use strict";return function(e){var r=t.mixin([e]);return r}}),register("Func",[],function(){"use strict";function t(t){var e=Array.prototype.slice.call(arguments,1);return function(){for(var r=e.slice(),n=0;n<arguments.length;n++)r.push(arguments[n]);return t.apply(this,r)}}function e(e,r){return t(r,e)}function r(t){return function(){var e=Array.prototype.slice.call(arguments),r=e.length;return function(n){return e[r]=n,t.apply(this,e)}}}return{partial:t,fastPartial:r,wrap:e}}),register("HashArray",function(){"use strict";function t(){this.values=[],this.keyMap={}}function e(t,e){var r;for(r in t)t.hasOwnProperty(r)&&t[r]>e&&t[r]--}function r(t,e){var r;for(r in t)t.hasOwnProperty(r)&&t[r]>=e&&t[r]++}return t.prototype.set=function(t,e){return this.keyMap[t]?(this.values[this.keyMap[t]]=e,!0):(this.values.push(e),this.keyMap[t]=this.values.length-1,!1)},t.prototype.splice=function(t,e,n){var o=this.keyMap[t]+1;this.values.splice(o,0,n),r(this.keyMap,o),this.keyMap[e]=o},t.prototype.get=function(t){return this.values[this.keyMap[t]]},t.prototype.remove=function(t){var r=this.keyMap[t];this.values.splice(r,1),e(this.keyMap,r),delete this.keyMap[t]},t.prototype.removeAll=function(){var t,e=this.keyMap;this.values.length=0;for(t in e)delete e[t]},t.prototype.getIdByIndex=function(t){var e,r=this.keyMap;for(e in r)if(r[e]===t)return e;return""},t.prototype.getKeys=function(){var t,e=this.size(),r=[];for(t=0;e>t;t++)r.push(this.getIdByIndex(t));return r},t.prototype.getValues=function(){return this.values},t.prototype.size=function(){return this.values.length},t}),CommonJS?kilo.register("Http",["Util"],function(t){function e(t,e){switch(t){case"application/json":case"application/json; charset=utf-8":return JSON.parse(e);default:return e}}function r(r,n,o){var i=new Promise(function(i,s){var u=http.request(r,function(r){var u="";t.isFunction(n)&&(o=n,n=null),r.setEncoding("utf8"),r.on("data",function(t){u+=t,o&&o(t.length,u.length)}),r.on("end",function(){var t=r.headers["content-type"];switch(r.statusCode){case 500:s({statusText:"",status:r.statusCode});break;case 404:s({statusText:"",status:r.statusCode});break;case 304:i({data:e(t,u),status:r.statusCode});break;default:i({data:e(t,u),status:r.statusCode})}})});u.on("error",function(t){console.log("problem with request: "+t.message),console.log("URL: "+r),s("Network error.")}),u.end()});return i}return{get:r}}):register("Http",["Util"],function(t){"use strict";function e(t,e){switch(t){case"application/json":case"application/json; charset=utf-8":return JSON.parse(e);default:return e}}function r(r,n,o){return new Promise(function(i,s){var u=new XMLHttpRequest;t.isFunction(n)&&(o=n,n=null),o&&u.addEventListener("progress",function(t){o(t.loaded,t.total)},!1),u.onerror=function(){s(t.error("Network error."))},u.onload=function(){var t=n||this.getResponseHeader("content-type");switch(this.status){case 500:s({statusText:this.statusText,status:this.status});break;case 404:s({statusText:this.statusText,status:this.status});break;case 304:i({data:e(t,this.responseText),status:this.status});break;default:i({data:e(t,this.responseText),status:this.status})}},u.open("get",r,!0),u.send()})}return{get:r}}),register("KeyStore",["HashArray","Util"],function(t,e){"use strict";function r(){this.lastId=0,this.store=new t}return r.prototype.get=function(t){return this.store.get(t)},r.prototype.set=function(t,r){var n;return e.isDefined(r)?n=t||this.lastId++:(n=this.lastId++,r=t),this.store.add(n,r),n},r.prototype.setGroup=function(t,r){var n,o;return e.isDefined(r)?(n=t,e.isDefined(n)?o=this.get(n):(n=this.lastId++,o=[],this.store.add(n,o))):(n=this.lastId++,r=t,o=[],this.store.add(n,o)),o?o.push(r):console.error("Jack2d: keyStore: id '"+n+"' not found."),n},r.prototype.clear=function(t){e.isDefined(t)?this.store.remove(t):this.store.removeAll()},r.prototype.getItems=function(){return this.store.items},r}),register("Merge",["Obj"],function(t){"use strict";return t.merge.bind(t)}),register("Obj",["Injector","Util","Func","Pool"],function(t,e,r,n){"use strict";function o(t,e,r,o){return t=t||n.getObject(),e=e||n.getObject(),Object.keys(t).forEach(function(n){i(t,e,n,r,o)}),e}function i(t,n,o,i,s){return n.hasOwnProperty(o)?i?(n[o]=r.wrap(n[o],t[o]),e.log("Merge: wrapped '"+o+"'")):s?e.error("Failed to merge mixin. Method '"+o+"' caused a name collision."):(n[o]=t[o],e.log("Merge: overwrote '"+o+"'")):n[o]=t[o],n}function s(t,r){var n={};return Object.keys(t).forEach(function(o){e.isFunction(t[o])&&(n[o]=u(t[o],t,r))}),n}function u(t,r,n){return function(){var o=e.argsToArray(arguments);return n?(o.unshift(t),n.apply(r,o)):t.apply(r,o)}}function a(t,e,r){Object.keys(t).forEach(function(n){t[n]===e&&(t[n]=r)})}function c(t,e){return s(t,e)}function f(t){return l(t)}function l(t,e){var r;e=e||n.getObject();for(r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}function h(t){var r,n="";if(e.isObject(t))for(r in t)t.hasOwnProperty(r)&&!e.isFunction(t[r])&&(n+=r+": "+t[r]+"<br>");return n}function p(t){var e;for(e in t)t.hasOwnProperty(e)&&delete t[e];return t}function y(t){return d(t)}function d(e,r,n){return t.process(e,function(t){r=o(t,r,!1,n)}),r}function g(e,r){return t.process(e,function(t){r=o(t,r,!0)}),r}return{print:h,clear:p,clone:y,quickClone:f,merge:d,quickMerge:l,wrap:g,augment:c,replaceMethod:a}}),register("Pool",[],function(){"use strict";function t(){var t=o.pop();return t||(t={}),t}function e(t){var e;for(e in t)t.hasOwnProperty(e)&&delete t[e];return t}function r(t){o.push(e(t))}function n(){return o.length}var o=[];return{getObject:t,killObject:r,available:n}}),register("rect",[],function(){"use strict";function t(t,e,r){return!(t<r.left||t>r.right||e<r.top||e>r.bottom)}function e(t,e){return!(t.left<e.left||t.right>e.right||t.top<e.top||t.bottom>e.bottom)}function r(t,e){var r=!(t.left<e.left||t.right>e.right);return r?!1:t.left-e.left}function n(t,e){return!(t<e.left||t>e.right)}function o(t,e){var r=!(t.top<e.top||t.bottom>e.bottom);return r?!1:t.top-e.top}function i(t,e){return!(t<e.top||t>e.bottom)}function s(t,e){var r=!(e.left>=t.right||e.right<=t.left);return r?t.left-e.left:!1}function u(t,e){var r=!(e.top>=t.bottom||e.bottom<=t.top);return r?t.top-e.top:!1}return{setLeft:function(t){return this.left=t,this},setTop:function(t){return this.top=t,this},setRight:function(t){return this.right=t,this},setBottom:function(t){return this.bottom=t,this},containsPoint:t,containsRect:e,containsX:n,containsY:i,containsRectX:r,containsRectY:o,intersectsRectX:s,intersectsRectY:u}}),register("Str",[],function(){"use strict";function t(){var t,e;return t=arguments[0],e=Array.prototype.slice.call(arguments,1),e.forEach(function(e){t=t.replace("%%",e)}),t}return{sprintf:t}}),register("Wrap",["Obj"],function(t){"use strict";return t.wrap.bind(t)}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var r,n;if(null==this)throw new TypeError(" this is null or not defined");var o=Object(this),i=o.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(r=e),n=0;i>n;){var s;n in o&&(s=o[n],t.call(r,s,n,o)),n++}}),Array.prototype.map||(Array.prototype.map=function(t,e){var r,n,o;if(null==this)throw new TypeError(" this is null or not defined");var i=Object(this),s=i.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(r=e),n=new Array(s),o=0;s>o;){var u,a;o in i&&(u=i[o],a=t.call(r,u,o,i),n[o]=a),o++}return n}),function(){function t(t,e){return function(){t.apply(e,arguments)}}function e(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],u(e,t(n,this),t(o,this))}function r(t){var e=this;return null===this._state?void this._deferreds.push(t):void c(function(){var r=e._state?t.onFulfilled:t.onRejected;if(null===r)return void(e._state?t.resolve:t.reject)(e._value);var n;try{n=r(e._value)}catch(o){return void t.reject(o)}t.resolve(n)})}function n(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var r=e.then;if("function"==typeof r)return void u(t(r,e),t(n,this),t(o,this))}this._state=!0,this._value=e,i.call(this)}catch(s){o.call(this,s)}}function o(t){this._state=!1,this._value=t,i.call(this)}function i(){for(var t=0,e=this._deferreds.length;e>t;t++)r.call(this,this._deferreds[t]);this._deferreds=null}function s(t,e,r,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=r,this.reject=n}function u(t,e,r){var n=!1;try{t(function(t){n||(n=!0,e(t))},function(t){n||(n=!0,r(t))})}catch(o){if(n)return;n=!0,r(o)}}var a;a="object"==typeof window&&window?window:global,"undefined"!=typeof module&&module.exports?module.exports=a.Promise?a.Promise:e:a.Promise||(a.Promise=e);var c=a.setImmediate||function(t){setTimeout(t,1)},f=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};e.prototype["catch"]=function(t){return this.then(null,t)},e.prototype.then=function(t,n){var o=this;return new e(function(e,i){r.call(o,new s(t,n,e,i))})},e.all=function(){var t=Array.prototype.slice.call(1===arguments.length&&f(arguments[0])?arguments[0]:arguments);return new e(function(e,r){function n(i,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var u=s.then;if("function"==typeof u)return void u.call(s,function(t){n(i,t)},r)}t[i]=s,0===--o&&e(t)}catch(a){r(a)}}if(0===t.length)return e([]);for(var o=t.length,i=0;i<t.length;i++)n(i,t[i])})},e.resolve=function(t){return t&&"object"==typeof t&&t.constructor===e?t:new e(function(e){e(t)})},e.reject=function(t){return new e(function(e,r){r(t)})},e.race=function(t){return new e(function(e,r){for(var n=0,o=t.length;o>n;n++)t[n].then(e,r)})}}();